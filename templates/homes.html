{% extends "layout.html" %}

{% block title %}
Homes
{% endblock %}

{% block main %}
<div class="container-fluid hero identifyObserver d-flex shadow-lg align-items-end justify-content-center">
  <div class="text-center" id="herotext">
    <h1 class="display-4 mt-0 mb-0" id="heroh1">{{name | upper}}</h1>
  </div>
</div>
<div class="container mb-4 homeFont lato-font">
  <h2 id="building_name" style="font-weight: 700;">{{name | upper}}&nbsp;<span class="badge badge-secondary"
      style="font-size: 0.5em">{{4.3}} <i class="fas fa-star"></i> (Dummy)</span></h2>
  <div style="line-height: 0.5; font-size: 1.1em; text-transform: capitalize;">
    <p>Locality: {{details[0]['locality']}}</p>
    <p>Landmark: {{details[0]['landmark']}}</p>
    <p>City: {{details[0]['city']}}</p>
    <p>State: {{details[0]['state']}}</p>
    <p>Country: {{details[0]['country'] | upper}}</p>
  </div>
</div>
<div class="container shadow homeFont py-2 standard-border-radius lato-font" id="homeSelected1">
  <div class="row justify-content-start text-left">
    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-12">
      <h4 id="changeType">Type: {{h_type}}</h4>
    </div>
    <form class="col-xl-2 col-lg-2 col-md-3 col-sm-12" id="navsearch">
      <div class="dropdown">
        {% set proID = details[0]['id'] %}
        <select class="btn btn-outline-secondary text-secondary text-sm-1 bg-transparent rounded" aria-expanded="false"
          name="type" onchange="cc('{{proID}}' + '$' + this.value)" id="selectType1" required>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <option class="dropdown-item" value="" disabled selected>Change Type?</option>
            {% for ty in types_available %}
            <option class="dropdown-item" value="{{ty}}">{{ty}}</option>
            {% endfor %}
          </div>
        </select>
      </div>
    </form>
  </div>
</div>
<div class="container shadow mt-2 mb-5 homeFont" id="home_featues">
  <div class="row">
    <div class="col-sm-6">
      <h3>What's nearby?</h3>
      <h5>(Under 1 Km radius):</h5>
      <ul style="font-size: 1.1em; text-transform: capitalize;" id="homeUL0" style="font-size: 1.1em">
        <li>Malls: {{nearby[0]['malls']}}</li>
        <li>Hospitals: {{nearby[0]['hospitals']}}</li>
        <li>Parks: {{nearby[0]['parks']}}</li>
        <li>Public Transportations: {{nearby[0]['transportations']}}</li>
        <li>Neighborhood: {{details[0]['neighbourhood']}}</li>
        <li>Vegetable Markets: {{nearby[0]['vegetable_shops']}}</li>
        <li>Pharmacies: {{nearby[0]['pharmacies']}}</li>
        <li>Schools: {{nearby[0]['schools']}}</li>
        <li>Colleges: {{nearby[0]['colleges']}}</li>
        <li>Universities: {{nearby[0]['universities']}}</li>
      </ul>
    </div>
    <div class="col-sm-6">
      <h3>Amenities:</h3>
      <ul style="font-size: 1.1em; text-transform: capitalize;">
        <li>Basic furnitures: {{features[0]['basic_furnitures']}}</li>
        <li>Parking: {{features[0]['parking']}}</li>
        <li>Security Cameras: {{features[0]['security_cameras']}}</li>
        <li>Security Guard: {{features[0]['security_guards']}}</li>
        <li>Balcony: {{features[0]['balcony']}}</li>
        <li>Attached bathrooms: {{features[0]['attached_bathrooms']}}</li>
        <li>General bathroom: {{features[0]['general_bathroom']}}</li>
        <li>Geyser: {{features[0]['geyser']}}</li>
        <li>Refrigerator: {{features[0]['refrigerator']}}</li>
        <li>Sofas: {{features[0]['sofas']}}</li>
      </ul>
    </div>
  </div>
</div>

<div class="container homeFont lato-font interiors-img" id="homeSelected2">
  <h3 style="font-weight: 700">Interiors:</h3>
  <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
    <ol class="carousel-indicators">
      <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
      <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
      <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
      <li data-target="#carouselExampleCaptions" data-slide-to="3"></li>
    </ol>

    <!--
    <div class="carousel-inner">
      {% for i in range(interiors | length) %}
        <div class="carousel-item active">
          <img src="static/images/partners/{{interiors[i]['interior_images']}}" class="d-block w-100" alt="...">
          <div class="carousel-caption d-md-block">
            <h2 id="photoCaption">Bedroom</h2>
          </div>
        </div>
      {% endfor %}
    </div>
    <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
  -->

    <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
      <ol class="carousel-indicators">
        <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
        <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
        <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
        <li data-target="#carouselExampleCaptions" data-slide-to="3"></li>
      </ol>

      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="static/images/partners/{{interiors[0]['interior_images']}}" class="d-block w-100" alt="...">
          <div class="carousel-caption d-md-block">
            <h2 class="grey_shade" id="photoCaption">Bathroom</h2>
          </div>
        </div>
        <div class="carousel-item">
          <img src="static/images/partners/{{interiors[1]['interior_images']}}" class="d-block w-100" alt="...">
          <div class="carousel-caption d-md-block">
            <h2 class="grey_shade">Bedroom</h2>
          </div>
        </div>
        <div class="carousel-item">
          <img src="static/images/partners/{{interiors[2]['interior_images']}}" class="d-block w-100" alt="...">
          <div class="carousel-caption d-md-block">
            <h2 class="grey_shade">Kitchen</h2>
          </div>
        </div>
        <div class="carousel-item">
          <img src="static/images/partners/{{interiors[3]['interior_images']}}" class="d-block w-100" alt="...">
          <div class="carousel-caption d-md-block">
            <h2 class="grey_shade">Living Room</h2>
          </div>
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
  </div>
</div>

<div class="container homeFont lato-font margin-bottom standard-border-radius standard-padding shadow"
  id="homeSelected2">
  <h3 style="font-weight: 700">Inspect sound level:</h3>
  <div class="row">
    <div class="col-lg-4 col-md-6 col-12 margin-bottom">
      <h6 style="margin-left: 1%;">Day-time sound with windows open</h6>
      <div>
        <audio controls>
          <source src="static/images/partners/{{audios[0]['audio_file']}}" type="audio/{{audios[0]['audio_type']}}">
        </audio>
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-12 margin-bottom">
      <h6 style="margin-left: 1%;">Day-time sound with closed windows</h6>
      <div>
        <audio controls>
          <source src="static/images/partners/{{audios[1]['audio_file']}}" type="audio/{{audios[1]['audio_type']}}">
        </audio>
      </div>
    </div>
    <div class="col-lg-4 col-md-6 col-12 margin-bottom">
      <h6 style="margin-left: 1%;">Night-time sound with closed windows</h6>
      <div>
        <audio controls>
          <source src="static/images/partners/{{audios[2]['audio_file']}}" type="audio/{{audios[2]['audio_type']}}">
        </audio>
      </div>
    </div>
  </div>
</div>

<div class="container shadow homeFont lato-font" id="pricing_payment">
  <div class="row">
    <div class="pricingDetails col-md-6">
      <h4>Pricing details:</h4>
      <h6 style="padding-left: 1.2em; font-family: 'Montserrat', sans-serif;"><span id="type_changer2">Type:
          {{h_type}}</span> &nbsp;&nbsp;
        <span>
          {% set proID = details[0]['id'] %}
          <select class="form-select btn btn-outline-secondary bg-transparent text-secondary" aria-expanded="false"
            name="type" onchange="cc('{{proID}}' + '$' + this.value)" id="selectType2" required>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
              <option class="dropdown-item" value="" disabled selected>Change Type?</option>
              {% for ty in types_available %}
              <option class="dropdown-item" value="{{ty}}">{{ty}}</option>
              {% endfor %}
            </div>
          </select>
        </span>
      </h6>
      <ul style="font-size: 1.1em">
        <input id="bhk_details_price" name="bhk_details_price" type="hidden" value={{bhk_details[0][price_bhk]}}>
        {% set monthly = bhk_details[0][price_bhk] %}
        <li id="monthly"></li>
        {% set security = bhk_details[0][price_bhk] * 2 %}
        <li id="security"></li>
        {% set actual_price = security + monthly %}
        <li id="total"></li>
        {% set coupon = (security + monthly) / 10 * 4%}
        <li><span class="badge bg-danger text-white" style="font-size: 0.7em">HOMIFY JOY</span> coupon applied <span
            style="font-size: 0.75em">(40% OFF)</span></li>
        <li id="coupon"></li>
      </ul>
      {% set total = security + monthly - coupon %}
      <h5 style="padding-left: 1.2em"><span style="font-weight: bold">Order Total:</span>
        <span id="strike" style="text-decoration-line: line-through;"></span>&nbsp;
        <span id="order_total"></span>
      </h5>
      <hr>
    </div>


    <input id="h_type_value" type="hidden" name="home_type" value="{{h_type}}">
    <input id="price" type="hidden" name="price" value={{total}}>
    <input id="h_name_value" type="hidden" name="home_name" value="{{name}}">
    <input id="h_id_value" type="hidden" name="home_id" value="{{p_id}}">

    {% if session.user_id %}
    <div class="col-md-6" style="padding: 1em;">
      <p class="paynowoffer">Get <span class="badge bg-danger text-white">10%</span> extra discount if you pay now!</p>
      <form action="/purchase_process" method="post">
        <input id="h_type_valuePy" type="hidden" name="home_type" value="{{h_type}}">
        <input id="h_id_valuePy" type="hidden" name="home_id" value="{{p_id}}">
        <input id="h_name_valuePy" type="hidden" name="home_name" value="{{name}}">
        <input id="modePy" type="hidden" name="mode" value="payment">
        <input id="pricePy" type="hidden" name="price" value="{{total}}">
        <button id="poppins" type="submit" class="btn btn-danger credentialUser2WithSessionPy mr-2 mb-1">Book and
          paynow</button>
      </form>
      <span style="font-size: 1.1em; display: block; padding-left: 3.5em;">or</span>
      <div>
        <div class="input-group">
          <form action="/purchase_process" method="post">
            <label for="survey" style="display:block; font-size: 1.1em;">Pick a survey date:</label>
            <input id="h_type_valueSv" type="hidden" name="home_type" value="{{h_type}}">
            <input id="h_id_valueSv" type="hidden" name="home_id" value="{{p_id}}">
            <input id="h_name_valueSv" type="hidden" name="home_name" value="{{name}}">
            <input id="modeSv" type="hidden" name="mode" value="survey">
            <input id="priceSv" type="hidden" name="price" value="{{total}}">
            <input id="survey" class="form-control mb-1" type="date" name="surveyDate" value="{{current_date}}"
              min="{{current_date}}">
            <button type="submit" class="btn btn-danger credentialUser2WithSessionSv mb-1">Pay after the survey</button>
          </form>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-md-6" style="padding: 1em;">
      <p class="paynowoffer">Get <span class="badge bg-danger text-white">10%</span> extra discount if you pay now!</p>
      <button id="poppins" type="button" class="btn btn-danger credentialUser1 mr-2 mb-1">Book and pay now</button>
      <span style="font-size: 1.1em; display: block; padding-left: 3.5em;">or</span>
      <div>
        <div class="input-group">
          <form>
            <label for="survey" style="display:block; font-size: 1.1em;">Pick a survey date:</label>
            <input type="hidden" name="">
            <input id="survey" class="form-control mb-1" type="date" name="surveyDate" value="{{current_date}}"
              min="{{current_date}}">
            <button id="credentialUser2" type="button" class="btn btn-danger credentialUser2 mb-1">Pay after the
              survey</button>
          </form>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
<!--Modal Popup for payment redirection-->
<div class="modals" id="modals_users_payment">
  <div class="signupBoxPartner shadow">
    <div class="modals-header">
      <i class="fas fa-times" id="closeBtnUsers"></i>
    </div>
    <hr />
    <form id="userLoginForm_payment">
      <div class="form-row">
        <div class="form-group">
          <input type="text" placeholder="Email id or phone number" class="form-control" id="user_id" name="partner_id"
            autocomplete="off" required />
        </div>
      </div>
      <div class="form-row last-input">
        <div class="form-group">
          <input type="password" placeholder="Password" class="form-control" id="login_pw" name="passwordPartner"
            autocomplete="off" required />
        </div>
      </div>
      <div class="warning_message" id="pw_validation"></div>
      <div class="form-row buttonMargin">
        <div class="form-group">
          <button type="submit" placeholder="Password" class="form-control btn btn-primary" name="passwordPartner"
            autocomplete="off" id="partnerLogin">
            Log In
          </button>
        </div>
      </div>
      <div>
        <a style="text-align: center" href="#">Forgotten Password?</a>
      </div>
      <hr />
    </form>
    <div class="form-row buttonMarginOne">
      <div class="form-group">
        <button type="password" placeholder="Password" class="form-control btn text-white" id="modal-signup-usersPy"
          name="passwordPartner" autocomplete="off">
          Create New Account
        </button>
      </div>
    </div>
  </div>
</div>

<!--Modal Popup for survey redirection-->
<div class="modals" id="modals_users_survey">
  <div class="signupBoxPartner shadow">
    <div class="modals-header">
      <i class="fas fa-times" id="closeBtnUsers"></i>
    </div>
    <hr />
    <form id="userLoginForm_survey">
      <div class="form-row">
        <div class="form-group">
          <input type="text" placeholder="Email id or phone number" class="form-control" id="user_id_sv"
            name="partner_id" autocomplete="off" required />
        </div>
      </div>
      <div class="form-row last-input">
        <div class="form-group">
          <input type="password" placeholder="Password" class="form-control" id="login_pw_sv" name="passwordPartner"
            autocomplete="off" required />
        </div>
      </div>
      <div class="warning_message" id="pw_validation_sv"></div>
      <div class="form-row buttonMargin">
        <div class="form-group">
          <button type="submit" placeholder="Password" class="form-control btn btn-primary" name="passwordPartner"
            autocomplete="off" id="partnerLogin">
            Log In
          </button>
        </div>
      </div>
      <div>
        <a style="text-align: center" href="#">Forgotten Password?</a>
      </div>
      <hr />
    </form>
    <div class="form-row buttonMarginOne">
      <div class="form-group">
        <button type="password" placeholder="Password" class="form-control btn text-white" id="modal-signup-usersSv"
          name="passwordPartner" autocomplete="off">
          Create New Account
        </button>
      </div>
    </div>
  </div>
</div>

<!--<script src="static/modals_users_payment.js"></script>-->
<!--<script src="static/modals_users_survey.js"></script>-->
<script>
  var monthly = document.querySelector("#bhk_details_price").value;
  var security = monthly * 2;
  var actual_price = parseInt(monthly) + parseInt(security);
  var coupon = actual_price / 10 * 4;
  var total = actual_price - coupon;
  document.querySelector("#monthly").innerHTML = 'Monthly fee (1st Month): $' + monthly;
  document.querySelector("#security").innerHTML = 'Security deposit: $' + security;
  document.querySelector("#total").innerHTML = 'Total: $' + actual_price;
  document.querySelector("#coupon").innerHTML = 'You save: $' + coupon;
  document.querySelector("#strike").innerHTML = '$' + actual_price;
  document.querySelector("#order_total").innerHTML = '$' + total;

</script>

<!--User will directed to login/sign up page before redirecting to the purchase process because the user is not logged in-->
<script>
  //Handles: User who choosed to book and pay
  var userLogin = document.querySelector("#userLoginForm_payment");
  userLogin.addEventListener("submit", (e) => {
    var home_type = document.querySelector("#h_type_value").value;
    var home_id = document.querySelector("#h_id_value").value;
    var price = document.querySelector("#price").value;
    var home_name = document.querySelector("#h_name_value").value;

    var user_id = document.querySelector("#user_id").value;
    var login_pw = document.querySelector("#login_pw").value;
    var pw_validation = document.querySelector("#pw_validation");

    //var action = '';
    e.preventDefault();

    $.post(
      "/loginUser",
      {
        u_pw: login_pw,
        u_id: user_id,
      },
      function (message) {
        if (message == "correct") {
          window.location.replace("/purchase_process?q=" + home_id + '$' + price + '$' + 'payment' + '$' + home_type + '$' + home_name);
        } else {
          pw_validation.innerHTML = message;
        }
      }
    );
    //e.preventDefault();
  });


  //Handles: User who choosed to survey and pay later
  var userLogin1 = document.querySelector("#userLoginForm_survey");
  userLogin1.addEventListener("submit", (e) => {
    var home_type = document.querySelector("#h_type_value").value;
    var home_id = document.querySelector("#h_id_value").value;
    var price = document.querySelector("#price").value;
    var home_name = document.querySelector("#h_name_value").value;

    var user_id = document.querySelector("#user_id_sv").value;
    var login_pw = document.querySelector("#login_pw_sv").value;
    var survey = document.querySelector("#survey").value;
    var pw_validation_sv = document.querySelector("#pw_validation_sv");

    //var action = '';
    e.preventDefault();

    $.post(
      "/loginUser",
      {
        u_pw: login_pw,
        u_id: user_id,
      },
      function (message) {
        if (message == "correct") {
          window.location.replace("/purchase_process?q=" + home_id + '$' + price + '$' + 'survey' + '$' + home_type + '$' + home_name + '$' + survey);
        } else {
          pw_validation_sv.innerHTML = message;
        }
      }
    );
    //e.preventDefault();
  });
</script>

<script>
  var changeBG = document.querySelector(".hero");
  changeBG.style.backgroundImage = "url('static/images/partners/{{facade}}')";
</script>
{% endblock %}